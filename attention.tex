% https://q.uiver.app/#q=WzAsNzIsWzcsMiwiXFxiaWdjaXJjIl0sWzgsMiwiXFxiaWdjaXJjIl0sWzksMiwiXFxiaWdjaXJjIl0sWzEwLDIsIlxcYmlnY2lyYyJdLFsxMSwyLCJcXGJpZ2NpcmMiXSxbNyw0LCJcXGJpZ2NpcmMiXSxbOCw0LCJcXGJpZ2NpcmMiXSxbOSw0LCJcXGJpZ2NpcmMiXSxbMTAsNCwiXFxiaWdjaXJjIl0sWzExLDQsIlxcYmlnY2lyYyJdLFszLDIsIlxcYmlnY2lyYyJdLFsyLDIsIlxcYmlnY2lyYyJdLFsxLDIsIlxcYmlnY2lyYyJdLFs0LDQsIlxcYmlnY2lyYyJdLFszLDQsIlxcYmlnY2lyYyJdLFsyLDQsIlxcYmlnY2lyYyJdLFsxLDQsIlxcYmlnY2lyYyJdLFswLDQsIlxcYmlnY2lyYyJdLFsxNCwyLCJcXGJpZ2NpcmMiXSxbMTUsMiwiXFxiaWdjaXJjIl0sWzE2LDIsIlxcYmlnY2lyYyJdLFsxNywyLCJcXGJpZ2NpcmMiXSxbMTgsMiwiXFxiaWdjaXJjIl0sWzE0LDQsIlxcYmlnY2lyYyJdLFsxNSw0LCJcXGJpZ2NpcmMiXSxbMTYsNCwiXFxiaWdjaXJjIl0sWzE4LDQsIlxcYmlnY2lyYyJdLFsxNSw1LCJcXHRleHRjb2xvcnt3aGl0ZX17XFxjZG90fSJdLFsxNCw1LCJcXHRleHRjb2xvcnt3aGl0ZX17XFxjZG90fSJdLFsxNiw1LCJcXHRleHRjb2xvcnt3aGl0ZX17XFxjZG90fSJdLFsxNyw1LCJcXHRleHRjb2xvcnt3aGl0ZX17XFxjZG90fSJdLFsxOCw1LCJcXHRleHRjb2xvcnt3aGl0ZX17XFxjZG90fSJdLFsxOCwxLCJcXHRleHRjb2xvcnt3aGl0ZX17XFxjZG90fSJdLFsxNywxLCJcXHRleHRjb2xvcnt3aGl0ZX17XFxjZG90fSJdLFsxNiwxLCJcXHRleHRjb2xvcnt3aGl0ZX17XFxjZG90fSJdLFsxNSwxLCJcXHRleHRjb2xvcnt3aGl0ZX17XFxjZG90fSJdLFsxNCwxLCJcXHRleHRjb2xvcnt3aGl0ZX17XFxjZG90fSJdLFsxNCwzLCJcXHRleHRjb2xvcnt3aGl0ZX17XFxjZG90fSJdLFsxNSwzLCJcXHRleHRjb2xvcnt3aGl0ZX17XFxjZG90fSJdLFsxNiwzLCJcXHRleHRjb2xvcnt3aGl0ZX17XFxjZG90fSJdLFsxOCwzLCJcXHRleHRjb2xvcnt3aGl0ZX17XFxjZG90fSJdLFsxNyw0LCJcXGJpZ2NpcmMiXSxbMTgsMCwiXFx0ZXh0Y29sb3J7d2hpdGV9e1xcY2RvdH0iXSxbMTksMCwiXFx0ZXh0Y29sb3J7d2hpdGV9e1xcY2RvdH0iXSxbMTcsMywiXFx0ZXh0Y29sb3J7d2hpdGV9e1xcY2RvdH0iXSxbMTYsMCwiXFx0ZXh0Y29sb3J7d2hpdGV9e1xcY2RvdH0iXSxbMTYsNiwiXFx0ZXh0e3NlbGYtYXR0ZW50aW9ufSJdLFs5LDYsIlxcdGV4dHtmdWxseSBjb25uZWN0ZWR9Il0sWzIsNiwiXFx0ZXh0e2NvbnZvbHV0aW9ufSJdLFsxOSwyLCJxdWVyeSJdLFsxOSw0LCJrZXkiXSxbMjMsNCwiXFxiaWdjaXJjIl0sWzI0LDQsIlxcYmlnY2lyYyJdLFsyNSw0LCJcXGJpZ2NpcmMiXSxbMjYsNCwiXFxiaWdjaXJjIl0sWzI3LDIsIlxcYmlnY2lyYyJdLFsyOCwxLCJcXHRleHRjb2xvcnt3aGl0ZX17XFxjZG90fSJdLFsyNSw1LCJcXHRleHRjb2xvcnt3aGl0ZX17XFxjZG90fSJdLFsyMyw1LCJcXHRleHRjb2xvcnt3aGl0ZX17XFxjZG90fSJdLFsyNCw1LCJcXHRleHRjb2xvcnt3aGl0ZX17XFxjZG90fSJdLFsyNiw1LCJcXHRleHRjb2xvcnt3aGl0ZX17XFxjZG90fSJdLFsyOCw0LCJrZXkiXSxbMjgsMywidmFsdWUiXSxbMjgsMiwicXVlcnkiXSxbMjcsNCwiXFxiaWdjaXJjIl0sWzI3LDUsIlxcdGV4dGNvbG9ye3doaXRlfXtcXGNkb3R9Il0sWzI2LDMsIlxcc21hbGxcXHRleHRjb2xvcntibGFja317U197dC0xfX0iXSxbMjcsMSwiXFxzbWFsbHtvX3Q9U190cV90fSJdLFsyNiwyLCJcXHNjcmlwdHNpemV7U190PVNfdCt2X3RrX3ReVH0iXSxbMjYsNiwiXFx0ZXh0e2xpbmVhciBhdHRlbnRpb259Il0sWzE5LDMsInZhbHVlIl0sWzEzLDMsIntcXHNjcmlwdHNpemUgXFxmcmFje1xcZXhwKHEgXFxjZG90IGspfXtcXHN1bV97aj0xfV57bn0gXFxleHAocSBcXGNkb3Qga19qKX19Il0sWzYsMF0sWzUsMV0sWzUsMl0sWzUsM10sWzUsNF0sWzYsMV0sWzYsMl0sWzYsM10sWzYsNF0sWzcsMF0sWzcsMV0sWzcsMl0sWzcsM10sWzcsNF0sWzgsMF0sWzgsMV0sWzgsMl0sWzgsM10sWzgsNF0sWzksMF0sWzksMV0sWzksMl0sWzksM10sWzksNF0sWzUsMF0sWzE3LDEyXSxbMTYsMTJdLFsxNSwxMl0sWzE2LDExXSxbMTUsMTFdLFsxNCwxMV0sWzE1LDEwXSxbMTQsMTBdLFsxMywxMF0sWzI4LDM4LCIiLDEseyJvZmZzZXQiOi00LCJzaG9ydGVuIjp7InRhcmdldCI6ODB9LCJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJhcnJvd2hlYWQifSwiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFsyOSwzOCwiIiwxLHsib2Zmc2V0IjozLCJzaG9ydGVuIjp7InRhcmdldCI6NzB9fV0sWzMxLDI2LCIiLDEseyJzaG9ydGVuIjp7InRhcmdldCI6MTB9fV0sWzM5LDMxLCIiLDEseyJvZmZzZXQiOjUsInNob3J0ZW4iOnsic291cmNlIjo2MCwidGFyZ2V0IjoyMH19XSxbMTgsMzUsIiIsMSx7Im9mZnNldCI6LTUsInNob3J0ZW4iOnsidGFyZ2V0Ijo1MH19XSxbMTksMzYsIiIsMSx7Im9mZnNldCI6NSwic2hvcnRlbiI6eyJ0YXJnZXQiOjQwfX1dLFsyMiw0MywiIiwxLHsibGFiZWxfcG9zaXRpb24iOjQwLCJvZmZzZXQiOi00LCJzaG9ydGVuIjp7InNvdXJjZSI6MTAsInRhcmdldCI6NjB9fV0sWzI0LDE4XSxbNDEsMjFdLFsyNiwyMF0sWzI3LDQ0LCIiLDEseyJvZmZzZXQiOi01LCJzaG9ydGVuIjp7InRhcmdldCI6ODB9fV0sWzI1LDE5XSxbMjQsMjIsIiIsMCx7ImNvbG91ciI6WzAsMCw1Nl19XSxbMjYsMjIsIiIsMCx7ImNvbG91ciI6WzAsMCw1MF19XSxbMjUsMjAsIiIsMCx7ImNvbG91ciI6WzAsMCw4MV19XSxbMjUsMTgsIiIsMSx7ImNvbG91ciI6WzAsMCw5Ml19XSxbMjUsMjIsIiIsMCx7ImNvbG91ciI6WzAsMCw5MV19XSxbMjQsMTksIiIsMCx7ImNvbG91ciI6WzAsMCw5MV19XSxbMjQsMjAsIiIsMCx7ImNvbG91ciI6WzAsMCw4MV19XSxbMjYsMTksIiIsMSx7ImNvbG91ciI6WzAsMCw2Nl19XSxbMjAsNDUsIiIsMSx7InNob3J0ZW4iOnsic291cmNlIjoxMCwidGFyZ2V0Ijo2MH19XSxbNDUsMjIsIiIsMSx7Im9mZnNldCI6NCwic2hvcnRlbiI6eyJzb3VyY2UiOjUwLCJ0YXJnZXQiOjMwfX1dLFs1MSw1NSwiIiwwLHsiY29sb3VyIjpbMCwwLDk3XX1dLFs1Miw1NSwiIiwwLHsiY29sb3VyIjpbMCwwLDU2XX1dLFs1NCw1NSwiIiwwLHsiY29sb3VyIjpbMCwwLDkxXX1dLFs1NSw1NiwicV90IiwyLHsibGFiZWxfcG9zaXRpb24iOjIwLCJvZmZzZXQiOi01LCJzaG9ydGVuIjp7InRhcmdldCI6NjB9fV0sWzU3LDU0LCIiLDAseyJvZmZzZXQiOi01LCJzaG9ydGVuIjp7InRhcmdldCI6NjB9fV0sWzU0LDYwLCIiLDAseyJzaG9ydGVuIjp7InNvdXJjZSI6MTAsInRhcmdldCI6MzB9fV0sWzUyLDU4LCIiLDIseyJvZmZzZXQiOjUsInNob3J0ZW4iOnsic291cmNlIjo2MH19XSxbNTksNTIsIiIsMix7InNob3J0ZW4iOnsic291cmNlIjoyMCwidGFyZ2V0IjoyMH19XSxbNTQsNjUsIiIsMCx7Im9mZnNldCI6LTUsInNob3J0ZW4iOnsic291cmNlIjo1MH19XSxbNjQsNTUsIlxcdGV4dGNvbG9ye2JsYWNrfXt2X3RrX3ReVH0iLDEseyJjb2xvdXIiOlswLDAsNjhdfSxbMCwwLDY4LDFdXSxbNTMsNTUsIlxcdGV4dGNvbG9ye3doaXRlfXtcXGNkb3RcXDpcXDpcXDpcXDpcXGNkb3R9IiwxXSxbMjMsNzEsIiIsMSx7ImN1cnZlIjotMSwiY29sb3VyIjpbMCwwLDgxXSwic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibWFwcyB0byJ9LCJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzE4LDcxLCIiLDEseyJjdXJ2ZSI6MSwiY29sb3VyIjpbMCwwLDgxXSwic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoibWFwcyB0byJ9LCJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzEwNiwyMSwiIiwwLHsibGV2ZWwiOjEsImNvbG91ciI6WzAsMCw5N119XV0=
\[\begin{tikzcd}
	&&&&&&&&&&&&&&&& {\textcolor{white}{\cdot}} && {\textcolor{white}{\cdot}} & {\textcolor{white}{\cdot}} \\
	&&&&&&&&&&&&&& {\textcolor{white}{\cdot}} & {\textcolor{white}{\cdot}} & {\textcolor{white}{\cdot}} & {\textcolor{white}{\cdot}} & {\textcolor{white}{\cdot}} &&&&&&&&& {\small{o_t=S_tq_t}} & {\textcolor{white}{\cdot}} \\
	& \bigcirc & \bigcirc & \bigcirc &&&& \bigcirc & \bigcirc & \bigcirc & \bigcirc & \bigcirc &&& \bigcirc & \bigcirc & \bigcirc & \bigcirc & \bigcirc & query &&&&&&& {\scriptsize{S_t=S_t+v_tk_t^T}} & \bigcirc & query \\
	&&&&&&&&&&&&& {{\scriptsize \frac{\exp(q \cdot k)}{\sum_{j=1}^{n} \exp(q \cdot k_j)}}} & {\textcolor{white}{\cdot}} & {\textcolor{white}{\cdot}} & {\textcolor{white}{\cdot}} & {\textcolor{white}{\cdot}} & {\textcolor{white}{\cdot}} & value &&&&&&& {\small\textcolor{black}{S_{t-1}}} && value \\
	\bigcirc & \bigcirc & \bigcirc & \bigcirc & \bigcirc &&& \bigcirc & \bigcirc & \bigcirc & \bigcirc & \bigcirc &&& \bigcirc & \bigcirc & \bigcirc & \bigcirc & \bigcirc & key &&&& \bigcirc & \bigcirc & \bigcirc & \bigcirc & \bigcirc & key \\
	&&&&&&&&&&&&&& {\textcolor{white}{\cdot}} & {\textcolor{white}{\cdot}} & {\textcolor{white}{\cdot}} & {\textcolor{white}{\cdot}} & {\textcolor{white}{\cdot}} &&&&& {\textcolor{white}{\cdot}} & {\textcolor{white}{\cdot}} & {\textcolor{white}{\cdot}} & {\textcolor{white}{\cdot}} & {\textcolor{white}{\cdot}} \\
	&& {\text{convolution}} &&&&&&& {\text{fully connected}} &&&&&&& {\text{self-attention}} &&&&&&&&&& {\text{linear attention}}
	\arrow[shift right=4, shorten <=34pt, shorten >=20pt, from=1-17, to=3-19]
	\arrow[shift left=5, shorten >=10pt, from=3-15, to=2-16]
	\arrow[color={rgb,255:red,207;green,207;blue,207}, curve={height=6pt}, maps to, no head, from=3-15, to=4-14]
	\arrow[shift right=5, shorten >=8pt, from=3-16, to=2-15]
	\arrow[shorten <=3pt, shorten >=19pt, from=3-17, to=1-17]
	\arrow[shift left=4, shorten <=4pt, shorten >=23pt, from=3-19, to=1-20]
	\arrow["{q_t}"'{pos=0.2}, shift left=5, shorten >=15pt, from=3-28, to=2-29]
	\arrow[shift right=5, shorten <=40pt, shorten >=13pt, from=4-17, to=6-19]
	\arrow[from=5-1, to=3-2]
	\arrow[from=5-2, to=3-2]
	\arrow[from=5-2, to=3-3]
	\arrow[from=5-3, to=3-2]
	\arrow[from=5-3, to=3-3]
	\arrow[from=5-3, to=3-4]
	\arrow[from=5-4, to=3-3]
	\arrow[from=5-4, to=3-4]
	\arrow[from=5-5, to=3-4]
	\arrow[from=5-8, to=3-8]
	\arrow[from=5-8, to=3-9]
	\arrow[from=5-8, to=3-10]
	\arrow[from=5-8, to=3-11]
	\arrow[from=5-8, to=3-12]
	\arrow[from=5-9, to=3-8]
	\arrow[from=5-9, to=3-9]
	\arrow[from=5-9, to=3-10]
	\arrow[from=5-9, to=3-11]
	\arrow[from=5-9, to=3-12]
	\arrow[from=5-10, to=3-8]
	\arrow[from=5-10, to=3-9]
	\arrow[from=5-10, to=3-10]
	\arrow[from=5-10, to=3-11]
	\arrow[from=5-10, to=3-12]
	\arrow[from=5-11, to=3-8]
	\arrow[from=5-11, to=3-9]
	\arrow[from=5-11, to=3-10]
	\arrow[from=5-11, to=3-11]
	\arrow[from=5-11, to=3-12]
	\arrow[from=5-12, to=3-8]
	\arrow[from=5-12, to=3-9]
	\arrow[from=5-12, to=3-10]
	\arrow[from=5-12, to=3-11]
	\arrow[from=5-12, to=3-12]
	\arrow[color={rgb,255:red,207;green,207;blue,207}, curve={height=-6pt}, maps to, no head, from=5-15, to=4-14]
	\arrow[from=5-16, to=3-15]
	\arrow[color={rgb,255:red,232;green,232;blue,232}, from=5-16, to=3-16]
	\arrow[color={rgb,255:red,207;green,207;blue,207}, from=5-16, to=3-17]
	\arrow[color={rgb,255:red,143;green,143;blue,143}, from=5-16, to=3-19]
	\arrow[color={rgb,255:red,235;green,235;blue,235}, from=5-17, to=3-15]
	\arrow[from=5-17, to=3-16]
	\arrow[color={rgb,255:red,207;green,207;blue,207}, from=5-17, to=3-17]
	\arrow[color={rgb,255:red,232;green,232;blue,232}, from=5-17, to=3-19]
	\arrow[from=5-18, to=3-18]
	\arrow[color={rgb,255:red,168;green,168;blue,168}, from=5-19, to=3-16]
	\arrow[from=5-19, to=3-17]
	\arrow[color={rgb,255:red,128;green,128;blue,128}, from=5-19, to=3-19]
	\arrow[color={rgb,255:red,247;green,247;blue,247}, from=5-24, to=3-28]
	\arrow[color={rgb,255:red,143;green,143;blue,143}, from=5-25, to=3-28]
	\arrow[shift right=5, shorten <=12pt, from=5-25, to=6-24]
	\arrow["{\textcolor{white}{\cdot\:\:\:\:\cdot}}"{description}, from=5-26, to=3-28]
	\arrow[color={rgb,255:red,232;green,232;blue,232}, from=5-27, to=3-28]
	\arrow[shorten <=1pt, shorten >=3pt, from=5-27, to=6-27]
	\arrow[shift left=5, shorten <=20pt, from=5-27, to=6-28]
	\arrow["{\textcolor{black}{v_tk_t^T}}"{description}, color={rgb,255:red,173;green,173;blue,173}, from=5-28, to=3-28]
	\arrow[""{name=0, anchor=center, inner sep=0}, shift left=4, shorten >=30pt, tail reversed, no head, from=6-15, to=4-16]
	\arrow[shift left=5, shorten >=64pt, from=6-16, to=4-18]
	\arrow[shift right=3, shorten >=31pt, from=6-17, to=4-16]
	\arrow[shorten >=1pt, from=6-19, to=5-19]
	\arrow[shorten <=2pt, shorten >=2pt, from=6-25, to=5-25]
	\arrow[shift left=5, shorten >=21pt, from=6-26, to=5-27]
	\arrow[color={rgb,255:red,247;green,247;blue,247}, from=0, to=3-18]
\end{tikzcd}\]